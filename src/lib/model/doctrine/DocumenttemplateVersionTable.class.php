<?php
/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class DocumenttemplateVersionTable extends Doctrine_Table {


     /**
     * create new instance of FormTemplate
     * @return object FormTemplate
     */
    public static function instance() {
        return Doctrine::getTable('DocumenttemplateVersion');
    }

    /**
     * Set template inactive
     * @param int $id
     * @return true
     */
    public function setTemplateInactiveById($id) {
        Doctrine_Query::create()
            ->update('DocumenttemplateVersion dtv')
            ->set('dtv.activeversion','?',0)
            ->where('dtv.id = ?', $id)
            ->execute();
        return true;
    }


    /**
     * Set template inactive
     * @param int $id
     * @return true
     */
    public function setTemplateActiveById($id) {
        Doctrine_Query::create()
            ->update('DocumenttemplateVersion dtv')
            ->set('dtv.activeversion','?',1)
            ->where('dtv.id = ?', $id)
            ->execute();
        return true;
    }

    /**
     * Set all templates inactive
     * @param int $id
     * @return true
     */
    public function setAllTemplateInactiveByTemplateId($id) {
        Doctrine_Query::create()
            ->update('DocumenttemplateVersion dtv')
            ->set('dtv.activeversion','?',0)
            ->where('dtv.documenttemplate_id = ?', $id)
            ->execute();
        return true;
    }
    /**
     *
     * @param int $id, id of the template
     * @return Doctrine_Collection
     */
    public function getDocumentTemplateId($id) {
        return Doctrine_Query::create()
            ->select('dtv.documenttemplate_id, dtv.version')
            ->from('DocumenttemplateVersion dtv')
            ->where('dtv.id = ?', $id)
            ->execute();
    }


    /**
     * Load all Versions to a Documenttemplate by its parent id
     * @param int $id, id of parent element
     * @return Doctrine_Collection
     */
    public function getAllVersionByTemplateId($id) {
        return Doctrine_Query::create()
            ->select('dtv.*')
            ->from('DocumenttemplateVersion dtv')
            ->where('dtv.documenttemplate_id = ?', $id)
            ->orderBy('dtv.created_at DESC')
            ->execute();
    }

    /**
     * Get Active Version of an template by id
     *
     * @param int $id, documenttemplate id
     * @return Doctrine_Collection
     */
    public function getActiveVersionById($id) {
        return Doctrine_Query::create()
            ->select('dtv.*')
            ->from('DocumenttemplateVersion dtv')
            ->where('dtv.documenttemplate_id = ?', $id)
            ->andWhere('dtv.activeversion = ?', 1)
            ->execute();
    }


    /**
     * get a documenttemplateversion by its id
     *
     * @param <type> $id
     * @return Doctrine_Collection
     */
    public function getVersionById($id) {
        return Doctrine_Query::create()
            ->select('dtv.*')
            ->from('DocumenttemplateVersion dtv')
            ->where('dtv.id = ?', $id)
            ->execute();
    }


}